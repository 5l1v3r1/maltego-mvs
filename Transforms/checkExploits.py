from MaltegoTransform import *
import logging
logging.basicConfig(level=logging.DEBUG,filename='/tmp/maltego_logs_bv.txt',format='%(asctime)s %(levelname)s: %(message)s',datefmt='%Y-%m-%d %H:%M:%S')
from common import *
import json
import requests

cve_string = TRX.getVar("cve")
cveList = cve_string.replace("CVE-", '').replace(" ","").split(",")

expL =[]
for cve in cveList:
    req = requests.get(api_service + "?exploit=True&cve=" + cve)
    if req and req.status_code == 200:
        result = json.loads(req.text)
        result = result.get("data")
        if len(result)>0 :
            for sploit in result[0].get("exploitDB"):
                expL.append(sploit)


for exp in expL:
    NewEnt=TRX.addEntity("sensepost.exploit", exp.get("desc"))
    NewEnt.addAdditionalFields("author", "author", "strict", exp.get("author"))
    NewEnt.addAdditionalFields("date", "date", "strict", exp.get("date"))
    NewEnt.addAdditionalFields("desc", "desc", "strict", exp.get("desc"))
    NewEnt.addAdditionalFields("link", "link", "strict", exp.get("link"))

TRX.returnOutput()
